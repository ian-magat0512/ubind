// <auto-generated />
#pragma warning disable 1591
namespace UBind.Persistence.Migrations
{
    using System;
    using System.Data.Entity.Migrations;
    using UBind.Persistence.Helpers;

    public partial class AddPersonReadModelWithUnusedColumnsInDBForMultiNodeDeployment : DbMigration
    {
        string startupJobName = "RemoveUnusedColumnsOnPersonReadModel_20211214";

        public override void Up()
        {
            /*
            // Currently it's deleted due to another migration, but we bring it back to not cause issues on
            // undeployed nodes still using the fields
            // the constraints are needed since we need to put default values on non-nullable fields
            this.Sql("ALTER TABLE dbo.PersonReadModels ADD Environment int NOT NULL CONSTRAINT Person_Environment DEFAULT (0) WITH VALUES");
            this.Sql("ALTER TABLE dbo.PersonReadModels ADD PersonId uniqueidentifier NOT NULL CONSTRAINT Person_PersonId DEFAULT ('00000000-0000-0000-0000-000000000000') WITH VALUES");

            // Create a startup job to set the fields back to deleted again, this startup job needs to run after all nodes in
            // multi-node environments
            var createStartupJobRecord = StartupJobRunnerQueryHelper.GenerateInsertQueryForStartupJobV1(
                startupJobName,
                false,
                true);
            Sql(createStartupJobRecord);
            */
        }

        public override void Down()
        {
            /*
            this.Sql(
                "IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE CONSTRAINT_SCHEMA = 'dbo' "
                + "AND TABLE_NAME = 'PersonReadModels' AND CONSTRAINT_NAME = 'Person_PersonId') "
                + "ALTER TABLE dbo.PersonReadModels DROP CONSTRAINT Person_PersonId");
            this.Sql(
                "IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS "
                + "WHERE TABLE_SCHEMA = 'dbo' "
                + "AND TABLE_NAME = 'PersonReadModels' "
                + "AND COLUMN_NAME = 'PersonId') "
                + "ALTER TABLE dbo.PersonReadModels DROP COLUMN PersonId");
            this.Sql(
                "IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS "
                + "WHERE TABLE_SCHEMA = 'dbo' "
                + "AND TABLE_NAME = 'PersonReadModels' "
                + "AND COLUMN_NAME = 'PersonId') "
                + "ALTER TABLE dbo.PersonReadModels DROP CONSTRAINT Person_Environment");
            this.Sql(
                "IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.COLUMNS "
                + "WHERE TABLE_SCHEMA = 'dbo' "
                + "AND TABLE_NAME = 'PersonReadModels' "
                + "AND COLUMN_NAME = 'Environment') "
                + "ALTER TABLE dbo.PersonReadModels DROP COLUMN Environment");

            // Remove startup job
            Sql(StartupJobRunnerQueryHelper.GenerateDeleteQueryForStartupJob(
                startupJobName));
            */
        }
    }
}
