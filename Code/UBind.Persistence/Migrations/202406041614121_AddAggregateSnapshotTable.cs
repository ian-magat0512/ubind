// <auto-generated />
#pragma warning disable 1591

namespace UBind.Persistence.Migrations;

using System.Data.Entity.Migrations;
using UBind.Persistence.Helpers;
using UBind.Persistence.Migrations.Extensions;

public partial class AddAggregateSnapshotTable : DbMigration
{
    private const string StartupJobAliasForQuoteAggregate = "AddQuoteAggregateSnapshot_20240507";

    public override void Up()
    {
        CreateTable(
            "dbo.AggregateSnapshots",
            c => new
            {
                Id = c.Guid(nullable: false),
                TenantId = c.Guid(nullable: false),
                AggregateId = c.Guid(nullable: false),
                AggregateType = c.Int(nullable: false),
                Version = c.Int(nullable: false),
                Json = c.String(nullable: false),
                CreatedTicksSinceEpoch = c.Long(nullable: false),
            })
            .PrimaryKey(t => t.Id);

        this.CreateIndexDropFirstIfExists("dbo.AggregateSnapshots",
            new[] { "Id", "TenantId", "CreatedTicksSinceEpoch" },
            unique: false,
            "IX_AggregateSnapshots_Id_TenantId_CreatedTicksSinceEpoch",
            clustered: false);

        this.CreateIndexDropFirstIfExists("dbo.AggregateSnapshots",
            new[] { "TenantId", "AggregateId", "AggregateType", "CreatedTicksSinceEpoch" },
            unique: false,
            "IX_AggregateSnapshots_TenantId_AggregateId_AggregateType_CreatedTicksSinceEpoch",
            clustered: false);

        this.Sql(StartupJobRunnerQueryHelper.GenerateInsertQueryForStartupJob(StartupJobAliasForQuoteAggregate));

    }

    public override void Down()
    {
        DropIndex("dbo.AggregateSnapshots", "IX_AggregateSnapshots_Id_TenantId_CreatedTicksSinceEpoch");
        DropIndex("dbo.AggregateSnapshots", "IX_AggregateSnapshots_TenantId_AggregateId_AggregateType_CreatedTicksSinceEpoch");
        DropTable("dbo.AggregateSnapshots");

        this.Sql(StartupJobRunnerQueryHelper.GenerateDeleteQueryForStartupJob(StartupJobAliasForQuoteAggregate));
    }
}